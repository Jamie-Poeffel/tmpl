# Express TypeScript API Template

function: d(name) {
    mkdir: $name
}

function: c(name) {
    create_file: $name
}

# Get project details
var: folder = input(What is your project named?, my-express-api)
var: port = input(What port should the server run on?, 3000)
var: author = input(Author name?, Your Name)
var: use_git = input(Initialize git repository? (yes/no), yes)

# Create root directory
d($folder)
cd: $folder

# Initialize npm and install dependencies
command
- npm init -y
- npm install express cors dotenv
- npm install -D typescript @types/node @types/express @types/cors ts-node nodemon
- npx tsc --init
end_command

# .gitignore
write_file(.gitignore): <<EOF
node_modules
dist
.env
*.log
.DS_Store
EOF>>

# .env
write_file(.env): <<EOF
PORT=$port
NODE_ENV=development
API_VERSION=v1
EOF>>

# .env.example
write_file(.env.example): <<EOF
PORT=3000
NODE_ENV=development
API_VERSION=v1
EOF>>

# package.json
write_file(package.json): <<EOF
{
  "name": "$folder",
  "version": "1.0.0",
  "description": "Express TypeScript API",
  "main": "dist/index.js",
  "author": "$author",
  "license": "MIT",
  "scripts": {
    "dev": "nodemon --exec ts-node src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    "clean": "rm -rf dist"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "typescript": "^5.3.3",
    "@types/node": "^20.10.5",
    "@types/express": "^4.17.21",
    "@types/cors": "^2.8.17",
    "ts-node": "^10.9.2",
    "nodemon": "^3.0.2"
  }
}
EOF>>

# tsconfig.json
write_file(tsconfig.json): <<EOF
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
EOF>>

# README.md
write_file(README.md): <<EOF
# $folder

Express TypeScript API

## Installation
\`\`\`bash
npm install
\`\`\`

## Development
\`\`\`bash
npm run dev
\`\`\`

## Build
\`\`\`bash
npm run build
\`\`\`

## Start Production
\`\`\`bash
npm start
\`\`\`

## Environment Variables
Copy \`.env.example\` to \`.env\`.

## Project Structure
\`\`\`
src/
â”œâ”€â”€ config/
â”œâ”€â”€ controllers/
â”œâ”€â”€ middlewares/
â”œâ”€â”€ models/
â”œâ”€â”€ routes/
â”œâ”€â”€ services/
â”œâ”€â”€ types/
â””â”€â”€ index.ts
\`\`\`
EOF>>

# src structure
d(src)
cd: src

d(config)
d(controllers)
d(models)
d(services)
d(types)
d(routes)
d(middlewares)

# src/index.ts
write_file(index.ts): <<EOF
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import router from './routes/router';
import { errorHandler } from './middlewares/error.middleware';

dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

app.use(cors());
app.use(express.json());
app.use('/api', router);

app.get('/health', (_, res) => {
  res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

app.use(errorHandler);

app.listen(PORT, () => {
  console.log(\`ðŸš€ Server running on http://localhost:\${PORT}\`);
});
EOF>>

# config
cd: config

write_file(app.config.ts): <<EOF
export const appConfig = {
  port: Number(process.env.PORT) || 3000,
  env: process.env.NODE_ENV || 'development',
};
EOF>>

write_file(database.config.ts): <<EOF
export const databaseConfig = {};
EOF>>

# routes
cd: ../routes

write_file(router.ts): <<EOF
import { Router } from 'express';
import { exampleController } from '../controllers/example.controller';

const router = Router();

router.get('/example', exampleController.getAll);

export default router;
EOF>>

# controllers
cd: ../controllers

write_file(example.controller.ts): <<EOF
import { Request, Response } from 'express';

export const exampleController = {
  getAll: async (_: Request, res: Response) => {
    res.json({ message: 'Hello from controller' });
  }
};
EOF>>

# middlewares
cd: ../middlewares

write_file(error.middleware.ts): <<EOF
import { Request, Response, NextFunction } from 'express';

export const errorHandler = (
  err: Error,
  _req: Request,
  res: Response,
  _next: NextFunction
) => {
  res.status(500).json({ message: err.message });
};
EOF>>

# services
cd: ../services

write_file(example.service.ts): <<EOF
export class ExampleService {
  findAll() {
    return [];
  }
}
EOF>>

# models
cd: ../models

write_file(example.model.ts): <<EOF
export interface Example {
  id: string;
  name: string;
}
EOF>>

# types
cd: ../types

write_file(index.ts): <<EOF
export interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
}
EOF>>

# git init
cd: ../..
if: $use_git == yes {
  command
  - git init
  - git add .
  - git commit -m "Initial commit: Express TypeScript API"
  end_command
}
