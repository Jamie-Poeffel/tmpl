# Express TypeScript API Template

function: d(name) {
    mkdir: $name
}

function: c(name) {
    create_file: $name
}

function: w(filename, content) {
    write_file($filename): $content
}

# Get project details
var: folder = input(What is your project named?, my-express-api)
var: port = input(What port should the server run on?, 3000)
var: author = input(Author name?, Your Name)
var: use_git = input(Initialize git repository? (yes/no), yes)

# Create root directory
d($folder)
cd: $folder

# Initialize npm and install dependencies
command
- npm init -y
- npm install express cors dotenv
- npm install -D typescript @types/node @types/express @types/cors ts-node nodemon
- npx tsc --init
end_command

# Create .gitignore
w(.gitignore): node_modules \n dist \n .env \n *.log \n .DS_Store

# Create .env file
w(.env): PORT=$port \n NODE_ENV=development \n API_VERSION=v1

# Create .env.example
w(.env.example): PORT=3000 \n NODE_ENV=development \n API_VERSION=v1

# Update package.json with scripts
w(package.json): <<EOF
{
  "name": "$folder",
  "version": "1.0.0",
  "description": "Express TypeScript API",
  "main": "dist/index.js",
  "author": "$author",
  "license": "MIT",
  "scripts": {
    "dev": "nodemon --exec ts-node src/index.ts",
    "build": "tsc",
    "start": "node dist/index.js",
    "clean": "rm -rf dist"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "typescript": "^5.3.3",
    "@types/node": "^20.10.5",
    "@types/express": "^4.17.21",
    "@types/cors": "^2.8.17",
    "ts-node": "^10.9.2",
    "nodemon": "^3.0.2"
  }
}
EOF>>

# Update tsconfig.json
w(tsconfig.json): <<EOF
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
EOF>>

# Create README
w(README.md): <<EOF
# $folder

Express TypeScript API

## Installation

\`\`\`bash
npm install
\`\`\`

## Development

\`\`\`bash
npm run dev
\`\`\`

## Build

\`\`\`bash
npm run build
\`\`\`

## Start Production

\`\`\`bash
npm start
\`\`\`

## Environment Variables

Copy \`.env.example\` to \`.env\` and update values as needed.

## Project Structure

\`\`\`
src/
â”œâ”€â”€ config/       # Configuration files
â”œâ”€â”€ controllers/  # Route controllers
â”œâ”€â”€ middlewares/  # Custom middlewares
â”œâ”€â”€ models/       # Data models
â”œâ”€â”€ routes/       # Route definitions
â”œâ”€â”€ services/     # Business logic
â”œâ”€â”€ types/        # TypeScript type definitions
â””â”€â”€ index.ts      # Entry point
\`\`\`
EOF>>

# Create src directory structure
d(src)
cd: src

d(config)
d(controllers)
d(models)
d(services)
d(types)
d(routes)
d(middlewares)

# Create main entry point
w(index.ts): <<EOF
import express, { Application } from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import router from './routes/router';
import { errorHandler } from './middlewares/error.middleware';

dotenv.config();

const app: Application = express();
const PORT = process.env.PORT || 3000;

// Middlewares
app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Routes
app.use('/api', router);

// Health check
app.get('/health', (req, res) => {
  res.status(200).json({ status: 'OK', timestamp: new Date().toISOString() });
});

// Error handling
app.use(errorHandler);

app.listen(PORT, () => {
  console.log(\`ðŸš€ Server is running on http://localhost:\${PORT}\`);
});

export default app;
EOF>>

# Create config files
cd: config
w(database.config.ts): <<EOF
export const databaseConfig = {
  // Add your database configuration here
};
EOF>>

w(app.config.ts): <<EOF
export const appConfig = {
  apiVersion: process.env.API_VERSION || 'v1',
  environment: process.env.NODE_ENV || 'development',
  port: parseInt(process.env.PORT || '3000', 10),
};
EOF>>

# Create route files
cd: ../routes
w(router.ts): <<EOF
import { Router } from 'express';
import { exampleController } from '../controllers/example.controller';

const router = Router();

// Example routes
router.get('/example', exampleController.getAll);
router.get('/example/:id', exampleController.getById);
router.post('/example', exampleController.create);
router.put('/example/:id', exampleController.update);
router.delete('/example/:id', exampleController.delete);

export default router;
EOF>>

# Create controller files
cd: ../controllers
w(example.controller.ts): <<EOF
import { Request, Response, NextFunction } from 'express';

export const exampleController = {
  getAll: async (req: Request, res: Response, next: NextFunction) => {
    try {
      // TODO: Implement logic
      res.status(200).json({ message: 'Get all examples' });
    } catch (error) {
      next(error);
    }
  },

  getById: async (req: Request, res: Response, next: NextFunction) => {
    try {
      const { id } = req.params;
      // TODO: Implement logic
      res.status(200).json({ message: \`Get example with id: \${id}\` });
    } catch (error) {
      next(error);
    }
  },

  create: async (req: Request, res: Response, next: NextFunction) => {
    try {
      // TODO: Implement logic
      res.status(201).json({ message: 'Create example', data: req.body });
    } catch (error) {
      next(error);
    }
  },

  update: async (req: Request, res: Response, next: NextFunction) => {
    try {
      const { id } = req.params;
      // TODO: Implement logic
      res.status(200).json({ message: \`Update example with id: \${id}\`, data: req.body });
    } catch (error) {
      next(error);
    }
  },

  delete: async (req: Request, res: Response, next: NextFunction) => {
    try {
      const { id } = req.params;
      // TODO: Implement logic
      res.status(200).json({ message: \`Delete example with id: \${id}\` });
    } catch (error) {
      next(error);
    }
  },
};
EOF>>

# Create middleware files
cd: ../middlewares
w(auth.middleware.ts): <<EOF
import { Request, Response, NextFunction } from 'express';

export const authMiddleware = (req: Request, res: Response, next: NextFunction) => {
  try {
    // TODO: Implement authentication logic
    const token = req.headers.authorization?.split(' ')[1];
    
    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }

    // Verify token here
    next();
  } catch (error) {
    res.status(401).json({ error: 'Invalid token' });
  }
};
EOF>>

w(error.middleware.ts): <<EOF
import { Request, Response, NextFunction } from 'express';

export const errorHandler = (
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
) => {
  console.error(err.stack);

  res.status(500).json({
    error: {
      message: err.message || 'Internal Server Error',
      ...(process.env.NODE_ENV === 'development' && { stack: err.stack }),
    },
  });
};
EOF>>

w(logger.middleware.ts): <<EOF
import { Request, Response, NextFunction } from 'express';

export const loggerMiddleware = (req: Request, res: Response, next: NextFunction) => {
  const timestamp = new Date().toISOString();
  console.log(\`[\${timestamp}] \${req.method} \${req.path}\`);
  next();
};
EOF>>

# Create service files
cd: ../services
w(example.service.ts): <<EOF
export class ExampleService {
  async findAll() {
    // TODO: Implement business logic
    return [];
  }

  async findById(id: string) {
    // TODO: Implement business logic
    return null;
  }

  async create(data: any) {
    // TODO: Implement business logic
    return data;
  }

  async update(id: string, data: any) {
    // TODO: Implement business logic
    return data;
  }

  async delete(id: string) {
    // TODO: Implement business logic
    return true;
  }
}

export default new ExampleService();
EOF>>

# Create model files
cd: ../models
w(example.model.ts): <<EOF
export interface Example {
  id: string;
  name: string;
  createdAt: Date;
  updatedAt: Date;
}

export class ExampleModel {
  // TODO: Implement model methods
}
EOF>>

# Create type definitions
cd: ../types
w(index.ts): <<EOF
export interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}

export interface PaginationParams {
  page: number;
  limit: number;
}

export interface PaginatedResponse<T> extends ApiResponse<T[]> {
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
  };
}
EOF>>

# Initialize git if requested
cd: ../..
if: $use_git == yes 
{
    command
    - git init
    - git add .
    - git commit -m "Initial commit: Express TypeScript API setup"
    end_command
}
